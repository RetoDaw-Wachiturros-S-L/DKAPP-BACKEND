option_settings:
  aws:elasticbeanstalk:container:php:phpini:
    document_root: /public
    memory_limit: 512M
  
  aws:elasticbeanstalk:application:environment:
    APP_ENV: production
    APP_DEBUG: false
    LOG_CHANNEL: errorlog

files:
  "/etc/php.d/99-custom.ini":
    mode: "000644"
    owner: root
    group: root
    content: |
      max_execution_time = 120
      post_max_size = 50M
      upload_max_filesize = 50M

container_commands:
  01_create_storage:
    command: |
      mkdir -p storage/framework/{cache/data,sessions,views,testing} storage/logs bootstrap/cache
      touch storage/logs/.gitkeep
    cwd: /var/app/staging

  02_set_permissions:
    command: |
      find . -type d -exec chmod 755 {} \;
      find . -type f -exec chmod 644 {} \;
      chmod -R 775 storage bootstrap/cache
      chown -R webapp:webapp storage bootstrap/cache
    cwd: /var/app/staging
